"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[87028],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var s=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,s,r=function(e,t){if(null==e)return{};var n,s,r={},a=Object.keys(e);for(s=0;s<a.length;s++)n=a[s],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)n=a[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=s.createContext({}),c=function(e){var t=s.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=c(e.components);return s.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return s.createElement(s.Fragment,{},t)}},d=s.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=c(n),h=r,m=d["".concat(l,".").concat(h)]||d[h]||p[h]||a;return n?s.createElement(m,o(o({ref:t},u),{},{components:n})):s.createElement(m,o({ref:t},u))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,o=new Array(a);o[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var c=2;c<a;c++)o[c]=n[c];return s.createElement.apply(null,o)}return s.createElement.apply(null,n)}d.displayName="MDXCreateElement"},21256:(e,t,n)=>{n.r(t),n.d(t,{frontMatter:()=>a,contentTitle:()=>o,metadata:()=>i,assets:()=>l,toc:()=>c,default:()=>p});var s=n(87462),r=(n(67294),n(3905));const a={title:"Experimental useController()",authors:["ntucker"],tags:["releases","rest-hooks","packages","usecontroller","resource","fetch"]},o=void 0,i={permalink:"/blog/2021/08/29/Experimental-useController",source:"@site/blog/2021-08-29-Experimental-useController.md",title:"Experimental useController()",description:"@rest-hooks/experimental is a new",date:"2021-08-29T00:00:00.000Z",formattedDate:"August 29, 2021",tags:[{label:"releases",permalink:"/blog/tags/releases"},{label:"rest-hooks",permalink:"/blog/tags/rest-hooks"},{label:"packages",permalink:"/blog/tags/packages"},{label:"usecontroller",permalink:"/blog/tags/usecontroller"},{label:"resource",permalink:"/blog/tags/resource"},{label:"fetch",permalink:"/blog/tags/fetch"}],readingTime:8.705,truncated:!0,authors:[{name:"Nathaniel Tucker",title:"Creator of Rest Hooks",url:"https://github.com/ntucker",imageURL:"https://github.com/ntucker.png",key:"ntucker"}],nextItem:{title:"Rest Hooks 4.2-4.5",permalink:"/blog/2020/02/18/Rest-Hooks-4.2-4.5"}},l={authorsImageUrls:[void 0]},c=[{value:"useController()",id:"usecontroller",children:[{value:"Usage",id:"usage",children:[]},{value:"Motivation",id:"motivation",children:[]},{value:"One hook, many endpoints",id:"one-hook-many-endpoints",children:[]},{value:"Completely flexible, variable arguments",id:"completely-flexible-variable-arguments",children:[]},{value:"Endpoint.update",id:"endpointupdate",children:[]},{value:"Resolution order",id:"resolution-order",children:[]},{value:"What&#39;s Next",id:"whats-next",children:[]}]},{value:"Resource changes",id:"resource-changes",children:[{value:"static list().paginated()",id:"static-listpaginated",children:[]},{value:"New Hiearchy",id:"new-hiearchy",children:[]}]}],u={toc:c};function p({components:e,...t}){return(0,r.kt)("wrapper",(0,s.Z)({},u,t,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/@rest-hooks/experimental"},"@rest-hooks/experimental")," is a new\npackage that allows us to quickly iterate on new designs by using them in production, which provides\nfeedback in ways not possible at design and testing phase."),(0,r.kt)("p",null,"This package is ",(0,r.kt)("strong",{parentName:"p"},"not")," api stable; it does follow semver, so it will never reach 1.0.\nHowever, it is tested with the same rigor we expect with Rest Hooks\nas we use it in production. It is recommend to use this for providing feedback or playing with designs,\nunless you are willing to put in extra work to make migrations. Detailed migration guides will only be\nprovided upon upstreaming to the mainline packages."),(0,r.kt)("p",null,"Today this package comes with two new features:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"/blog/2021/08/29/Experimental-useController#usecontroller"},"useController()"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const { fetch, invalidate, resetEntireStore } = useController();\nfetch(MyResource.detail(), { id });\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"/blog/2021/08/29/Experimental-useController#static-listpaginated"},"Resource.list().paginated()"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"class NewsResource extends Resource {\n  static listPage<T extends typeof NewsResource>(this: T) {\n    return this.list().paginated(({ cursor, ...rest }) => [rest]);\n  }\n}\n")),(0,r.kt)("h2",{id:"usecontroller"},"useController()"),(0,r.kt)("h3",{id:"usage"},"Usage"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useController } from '@rest-hooks/experimental';\n\nfunction MyComponent({ id }) {\n  const { fetch, invalidate, resetEntireStore } = useController();\n\n  const handleRefresh = useCallback(\n    async e => {\n      await fetch(MyResource.detail(), { id });\n    },\n    [fetch, id],\n  );\n\n  const handleSuspend = useCallback(\n    async e => {\n      await invalidate(MyResource.detail(), { id });\n    },\n    [invalidate, id],\n  );\n\n  const handleLogout = useCallback(\n    async e => {\n      resetEntireStore();\n    },\n    [resetEntireStore],\n  );\n}\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/coinbase/rest-hooks/pull/1048"},"PR")),(0,r.kt)("h3",{id:"motivation"},"Motivation"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Consolidate, simplify hooks"),(0,r.kt)("li",{parentName:"ul"},"Consistent interface between managers and hooks"),(0,r.kt)("li",{parentName:"ul"},"Global referential equality available everywhere (managers and updaters)"),(0,r.kt)("li",{parentName:"ul"},"Simplify and consolidate TTL and error concepts"),(0,r.kt)("li",{parentName:"ul"},"Less code in hooks = less work on rendering leaf nodes"),(0,r.kt)("li",{parentName:"ul"},"Icing on cake: ez migration to EndpointInterface and flexible args support for hooks"),(0,r.kt)("li",{parentName:"ul"},"Future breaking changes can allow ez migration with version strings sent to ",(0,r.kt)("inlineCode",{parentName:"li"},"useController({version: 'v2'})"))),(0,r.kt)("h3",{id:"one-hook-many-endpoints"},"One hook, many endpoints"),(0,r.kt)("p",null,"The rules of hooks are very restrictive, so the less hooks you have to call, the more flexible. This also benefits render performance. In many cases you might want to fetch many different endpoints. What's worse is if you don't know which endpoints you might want to fetch upfront. With old design you'd have to hook up every ",(0,r.kt)("em",{parentName:"p"},"possible")," one. This really destroys fetch-as-render pattern, as you want to be able to prefetch based on possible routes."),(0,r.kt)("h4",{id:"before"},"Before"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"const createUser = useFetcher(User.create());\nconst refreshUsers = useFetcher(User.list());\n\nreturn (\n  <form onSubmit={() => createUser({}, userPayload)}>\n    <button onClick={() => refreshUsers({})}>Refresh list</button>\n  </form>\n);\n")),(0,r.kt)("h4",{id:"after"},"After"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"const { fetch } = useController();\n\nreturn (\n  <form onSubmit={() => fetch(User.create(), {}, userPayload)}>\n    <button onClick={() => fetch(User.list(), {})}>Refresh list</button>\n  </form>\n);\n")),(0,r.kt)("h3",{id:"completely-flexible-variable-arguments"},"Completely flexible, variable arguments"),(0,r.kt)("p",null,"The concept of params + body for arguments was introduced to try to provide the most flexible approach in a world where type enforcement wasn't that flexible. With TypeScript 4's variadic tuples, it's now possible to strongly type arbitrary arguments to a function in a ",(0,r.kt)("em",{parentName:"p"},"generic")," way. Furthermore, stumbling upon package.json's typeVersions, rest hooks can now publish multiple type versions to be compatible with different versions of typescript. This allows us to eagerly adopt TypeScript 4 features, while providing a usable TypeScript 3 experience."),(0,r.kt)("p",null,"Some common annoyances with the current parameter limitations are single-variable arguments like detail endpoints with an id, as well as no-argument case like a list endpoint or create endpoint."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"const { fetch } = useController();\n\nreturn (\n  <form onSubmit={() => fetch(User.create(), userPayload)}>\n    <button onClick={() => fetch(User.list())}>Refresh list</button>\n  </form>\n);\n")),(0,r.kt)("p",null,"We'll also eventually bring this to the 'read' hooks like so:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"// notice username is just a string, rather than object\nconst user = useResource(User.detail(), username);\n// here we don't need arguments\nconst posts = useResource(Post.list());\n// but list() has it being optional, which means this also works:\nconst goodPosts = useResource(Post.list(), { good: true });\n// postId is a number in this case\nconst thePost = useResource(Post.detail(), postId);\n")),(0,r.kt)("h3",{id:"endpointupdate"},"Endpoint.update"),(0,r.kt)("p",null,"By normalizing ",(0,r.kt)("a",{parentName:"p",href:"https://resthooks.io/docs/api/Entity"},"Entities"),", Rest Hooks guarantees data integrity and consistency even down to the referential equality level. However, there are still some cases where side effects result in changes to the actual results themselves. The most common reason for this is creation of new entities. While 'creation' is almost universally the cause for this (as deletion is handled more simply by delete schemas), the structure of data and where created elements go is not universal."),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},(0,r.kt)("strong",{parentName:"p"},"Start using this now!")," Though this is the only way to use the new Controller.fetch,\nendpoints with ",(0,r.kt)("inlineCode",{parentName:"p"},"update")," work with the old ",(0,r.kt)("a",{parentName:"p",href:"https://resthooks.io/docs/api/useFetcher"},"useFetcher()")," hook as well."))),(0,r.kt)("h4",{id:"before-1"},"Before"),(0,r.kt)("p",null,"Previously this was enabled by an optional third argument to the fetch ",(0,r.kt)("a",{parentName:"p",href:"https://resthooks.io/docs/api/useFetcher#updateparams-destendpoint-destparams-updatefunction"},"UpdateParams")," enabling programmatic changes that are also strictly type enforced to ensure the data integrity of the Rest Hooks store."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"const createUser = new Endpoint(postToUserFunction, {\n  schema: User,\n});\n\nconst createUser = useFetcher(createUser);\n\ncreateUser({}, { id: 1 }, [\n  [\n    userList,\n    {},\n    (newUserID: string, userIDs: string[] | undefined) => [\n      ...(userIDs || []),\n      newUserID,\n    ],\n  ],\n]);\n")),(0,r.kt)("p",null,"While simple, this design had several shortcomings"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Only operates on the normalized results, often arrays of strings",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"This is non-intuitive as this doesn't relate directly to the data's form and requires understanding of internals"),(0,r.kt)("li",{parentName:"ul"},"Code is confusing with two ordered args and necessary default handling"))),(0,r.kt)("li",{parentName:"ul"},"Is provided as an argument to the fetch rather than endpoint",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Makes variable arguments impossible, and hard to reason about"),(0,r.kt)("li",{parentName:"ul"},"Makes pattern reuse still require explicit wiring"),(0,r.kt)("li",{parentName:"ul"},"Was thought to be more flexible than in 'fetchshape', as it has access to local variables in its event handler. However, Endpoints's can easily use ",(0,r.kt)("inlineCode",{parentName:"li"},".extend()")," to contextually override so this feature is moot."),(0,r.kt)("li",{parentName:"ul"},"Encourages antipatterns like writing hooks for specific endpoints")))),(0,r.kt)("h4",{id:"after-1"},"After"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Move to Endpoint"),(0,r.kt)("li",{parentName:"ul"},"builder pattern to make updater definition easy",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"typeahead"),(0,r.kt)("li",{parentName:"ul"},"strong type enforcement"),(0,r.kt)("li",{parentName:"ul"},"much more readable than a size 3 tuple")))),(0,r.kt)("p",null,"Simplest case:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="userEndpoint.ts"',title:'"userEndpoint.ts"'},"const createUser = new Endpoint(postToUserFunction, {\n  schema: User,\n  update: (newUserId: string) => ({\n    [userList.key()]: (users = []) => [newUserId, ...users],\n  }),\n});\n")),(0,r.kt)("p",null,"More updates:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Component.tsx"',title:'"Component.tsx"'},"const allusers = useResource(userList);\nconst adminUsers = useResource(userList, { admin: true });\n")),(0,r.kt)("p",null,"The endpoint below ensures the new user shows up immediately in the usages above."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="userEndpoint.ts"',title:'"userEndpoint.ts"'},"const createUser = new Endpoint(postToUserFunction, {\n  schema: User,\n  update: (newUserId, newUser)  => {\n    const updates = {\n      [userList.key()]: (users = []) => [newUserId, ...users],\n    ];\n    if (newUser.isAdmin) {\n      updates[userList.key({ admin: true })] = (users = []) => [newUserId, ...users];\n    }\n    return updates;\n  },\n});\n")),(0,r.kt)("p",null,"This is usage with a ",(0,r.kt)("a",{parentName:"p",href:"https://resthooks.io/docs/api/Resource"},"Resource")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="TodoResource.ts"',title:'"TodoResource.ts"'},"import { Resource } from '@rest-hooks/rest';\n\nexport default class TodoResource extends Resource {\n  readonly id: number = 0;\n  readonly userId: number = 0;\n  readonly title: string = '';\n  readonly completed: boolean = false;\n\n  pk() {\n    return `${this.id}`;\n  }\n\n  static urlRoot = 'https://jsonplaceholder.typicode.com/todos';\n\n  static create<T extends typeof Resource>(this: T) {\n    const todoList = this.list();\n    return super.create().extend({\n      schema: this,\n      // highlight-start\n      update: (newResourceId: string) => ({\n        [todoList.key({})]: (resourceIds: string[] = []) => [\n          ...resourceIds,\n          newResourceId,\n        ],\n      }),\n      // highlight-end\n    });\n  }\n}\n")),(0,r.kt)("h3",{id:"resolution-order"},"Resolution order"),(0,r.kt)("p",null,"This makes little difference in React 18 since renders are batched; however in React < 18, this means that code after promise resolution will be executed before react renders - allowing actions that need to take place as a result of successful fetch. For example navigating off a deleted page after delete."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"const handleDelete = useCallback(\n  async e => {\n    await fetch(MyResource.delete(), { id });\n    history.push('/');\n  },\n  [fetch, id],\n);\n")),(0,r.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"It's now recommended to wrap all fetches in act when testing like so:"),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"await act(async () => {\n  await result.current.fetch(ComplexResource.detail(), {\n    id: '5',\n  });\n});\n")))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/coinbase/rest-hooks/pull/1046"},"PR")),(0,r.kt)("h3",{id:"whats-next"},"What's Next"),(0,r.kt)("p",null,"Tentative plans look something like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const controller = useController();\n\n// actions\ncontroller.fetch(UserResource.detail(), { id }); // sideEffects means no throttle, otherwise throttle\ncontroller.receive(payload, UserResource.detail(), { id });\ncontroller.invalidate(UserResource.detail(), { id });\ncontroller.resetEntireStore();\ncontroller.subscribe(UserResource.detail(), { id });\ncontroller.unsubscribe(UserResource.detail(), { id });\n// posisble new\ncontroller.abort(UserResource.detail(), { id }); // only aborts if in flight\n// note: to force fetch of sideEffect: undefined - call abort first\n// this should enable good offline/online managers\n\n// retrieval\nconst state = useContext(StateContext);\nconst [value, expiresAt] = controller.getResponse(\n  state,\n  UserResource.detail(),\n  { id },\n);\nconst error = controller.getError(state, UserResource.detail(), { id });\n")),(0,r.kt)("h2",{id:"resource-changes"},"Resource changes"),(0,r.kt)("h3",{id:"static-listpaginated"},"static list().paginated()"),(0,r.kt)("h4",{id:"motivation-1"},"Motivation"),(0,r.kt)("p",null,"Pagination is a common scenario, that would benefit from minimal specification."),(0,r.kt)("h4",{id:"solution"},"Solution"),(0,r.kt)("p",null,"By default we rely on finding a list within the schema. The only remaining thing is figuring out how to extract the 'cursor' args to update the main list. Therefore, a function to do just that should be provided by the user like so."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"class NewsResource extends Resource {\n  static listPage<T extends typeof NewsResource>(this: T) {\n    return this.list().paginated(({ cursor, ...rest }) => [rest]);\n  }\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useResource } from 'rest-hooks';\nimport NewsResource from 'resources/NewsResource';\n\nfunction NewsList() {\n  const { results, cursor } = useResource(NewsResource.list(), {});\n  const curRef = useRef(cursor);\n  curRef.current = cursor;\n  const fetch = useFetcher();\n  const getNextPage = useCallback(\n    () => fetch(NewsResource.listPage(), { cursor: curRef.current }),\n    [],\n  );\n\n  return (\n    <Pagination onPaginate={getNextPage} nextCursor={cursor}>\n      <NewsList data={results} />\n    </Pagination>\n  );\n}\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/coinbase/rest-hooks/pull/868"},"PR")),(0,r.kt)("h3",{id:"new-hiearchy"},"New Hiearchy"),(0,r.kt)("p",null,"Not every Resource has the same endpoints. It may have additional methods to CRUD, or\nit could only support some operations. Furthermore, the exact nature and typings of endpoints\ncould vary widely making it hard to define a good base class, while also providing very specific types."),(0,r.kt)("p",null,"That's why there is a new ",(0,r.kt)("inlineCode",{parentName:"p"},"BaseResource")," that includes everything Resource had, but with\nabsolutely no endpoints. Instead it comes with an extensible 'abstract endpoint' BaseResource.endpoint()\nfor side-effect free endpoints, as well as BaseResource.endpointMutate()."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Resource")," is still provided, by simplying extending one of these endpoints like so"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"abstract class Resource extends BaseResource {\n  /** Endpoint to get a single entity */\n  static detail<T extends typeof Resource>(\n    this: T,\n  ): RestEndpoint<\n    (this: RestEndpoint, params: any) => Promise<any>,\n    SchemaDetail<AbstractInstanceType<T>>,\n    undefined\n  > {\n    const endpoint = this.endpoint();\n    return this.memo('#detail', () =>\n      endpoint.extend({\n        schema: this,\n      }),\n    );\n  }\n  // etc\n}\n")),(0,r.kt)("p",null,"This should make it much easier to get started quickly, while allowing for a powerful yet flexible\noptions in ",(0,r.kt)("inlineCode",{parentName:"p"},"BaseResource"),". We expect most medium-to-large applications to mostly use this class."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/coinbase/rest-hooks/pull/841"},"PR")))}p.isMDXComponent=!0}}]);